{% extends 'base.html.twig' %}

{% block body %}
    <div class="mt-5">
        {{ form_start(formFilter) }}
            <div class="row">
                <div class="col-4">
                    <div class="form-group">
                        {{ form_row(formFilter.currency_unit_id) }}
                    </div>
                </div>
                <div class="col-4">
                    <div class="form-group">
                        {{ form_row(formFilter.begin) }}
                    </div>
                </div>
                <div class="col-4">
                    <div class="form-group">
                        {{ form_row(formFilter.end) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_row(formFilter.save) }}
                </div>
            </div>

        {{ form_end(formFilter) }}
    </div>
    <div id="currency-chart" style="width: 900px; height: 500px" data-char-code="{{ currencyUnit.charCode }}" data-currencies="{{ currencies|json_encode }}"></div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        (function () {
            google.charts.load('current', {'packages':['line']});
            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {
                let currencies = $('#currency-chart').data('currencies');
                console.log(currencies);
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Дата');
                data.addColumn('number', $('#currency-chart').data('char-code'));

                data.addRows(currencies);

                var options = {
                    chart: {
                        title: 'Box Office Earnings in First Two Weeks of Opening',
                        subtitle: 'in millions of dollars (USD)'
                    },
                    width: 900,
                    height: 500
                };

                var chart = new google.charts.Line(document.getElementById('currency-chart'));

                chart.draw(data, google.charts.Line.convertOptions(options));
            }
        })();

    </script>
{% endblock %}