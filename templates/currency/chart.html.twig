{% extends 'base.html.twig' %}

{% block body %}
    <div class="mt-5">
        <form  action="" method="get">
            <div class="row">
                <div class="col-4">
                    <div class="form-group">
                        <select name="char_code" class="form-control">
                            {% for key, charCode in dropDownCharCode %}
                                <option value="{{ key }}" {{ key == selectedCharCode ? 'selected': '' }}>{{ charCode }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-4">
                    <div class="form-group">
                        <input type="text" class="datepicker form-control" value="{{ begin }}" name="begin">
                    </div>
                </div>
                <div class="col-4">
                    <div class="form-group">
                        <input type="text" class="datepicker form-control" value="{{ end }}" name="end">
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary">Показать</button>
                </div>
            </div>

        </form>
    </div>
    <div id="currency-chart" style="width: 900px; height: 500px" data-char-code="{{ selectedCharCode }}" data-currencies="{{ currencies|json_encode }}"></div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        (function () {
            google.charts.load('current', {'packages':['line']});
            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {
                let currencies = $('#currency-chart').data('currencies');
                console.log(currencies);
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Дата');
                data.addColumn('number', $('#currency-chart').data('char-code'));

                data.addRows(currencies);

                var options = {
                    chart: {
                        title: 'Box Office Earnings in First Two Weeks of Opening',
                        subtitle: 'in millions of dollars (USD)'
                    },
                    width: 900,
                    height: 500
                };

                var chart = new google.charts.Line(document.getElementById('currency-chart'));

                chart.draw(data, google.charts.Line.convertOptions(options));
            }
        })();

    </script>
{% endblock %}